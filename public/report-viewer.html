<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Report Viewer</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 24px; }
      .msg { color: #444; }
    </style>
  </head>
  <body>
    <div class="msg">Loading report...</div>
    <script>
      (function () {
        try {
          var params = new URLSearchParams(window.location.search);
          var id = params.get('id');
          if (!id) return;
          var key = 'generated_report_html_' + id;
          var content = localStorage.getItem(key);
          if (!content) return;

          // Extract title and set it on the viewer
          var m = content.match(/<title>(.*?)<\/title>/i);
          if (m && m[1]) document.title = m[1];

          // Replace the entire document with the report content
          // This ensures that right-click save downloads the actual report HTML
          document.open();
          document.write(content);
          document.close();
          
          // Reports persist indefinitely for multi-tab access
          // No automatic cleanup - reports remain available across tabs/reloads
        } catch (e) {
          console.error('Report viewer error:', e);
        }
      })();
    </script>
  </body>
  </html>


